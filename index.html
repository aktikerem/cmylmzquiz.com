<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>YouTube Lyrics Quiz</title>

  <style>
    body {
      background: #0f0f0f;
      color: #fff;
      font-family: system-ui, sans-serif;
      display: flex;
      justify-content: center;
      padding: 40px;
    }

    .app {
      width: 800px;
      background: #1a1a1a;
      padding: 20px;
      border-radius: 12px;
    }

    button {
      padding: 10px 18px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
    }

    #startBtn {
      background: #4caf50;
      color: #000;
      margin-bottom: 15px;
    }

    input {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      border-radius: 6px;
      border: none;
      margin-top: 10px;
    }

    .hidden {
      display: none;
    }

    #videoWrapper {
      margin-bottom: 15px;
      border-radius: 10px;
      overflow: hidden;
    }

    #questionBox {
      margin-top: 15px;
    }

    #score {
      margin-top: 10px;
      font-weight: bold;
    }
  </style>
</head>

<body>
  <div class="app">
    <button id="startBtn">Start Quiz</button>

    <div id="videoWrapper">
      <div id="player"></div>
    </div>

    <div id="questionBox" class="hidden">
      <p>What’s the next line?</p>
      <input id="answerInput" placeholder="Type here..." />
      <button id="submitBtn">Submit</button>
    </div>

    <div id="score">Score: 0</div>
  </div>

  <!-- YouTube IFrame API -->
  <script src="https://www.youtube.com/iframe_api"></script>

  <script>
    /***********************
     * QUESTION POOL
     * Add more videos here
     ***********************/
    const QUESTION_POOL = [
      {
        videoId: "m7b7havwYSw",
        answer: "değişecek zannediyor Yani hemen 1 Ocak 2000'de tak bir yerden bir yere ışınlan acağı zannediyor Hayır öyle bir şey yok yani elinizdeki abonmanı mavi kartları atmayın Onlar lazım olacak" // ← ENTER CORRECT NEXT LINE HERE
      },
      {
        videoId: "xCKnlQT37WE",
        answer: "klişe eylenme ve kutlama şeklinde en çok yakışan kırmızı don giyme olayı. Gerçekten Noel Baba'nın hani getirdiği çantada var mı bakalım? Kırmızı don. Bu biraz büyük umutlar için. Böyle salak süsler var. Bunları koyunca bambaşka bir insan oluyorsun herhalde. Öyle düşünülmüş." // ← ENTER CORRECT NEXT LINE HERE
      }
    ];

    const TOTAL_QUESTIONS = 10;
    const PLAY_TIME = 10;

    let player;
    let quiz = [];
    let current = 0;
    let score = 0;
    let timer;

    function shuffle(arr) {
      return [...arr].sort(() => Math.random() - 0.5);
    }

    function exponentialScore(wordCount) {
      return Math.floor(Math.pow(1.8, wordCount));
    }

    function similarity(a, b) {
      a = a.toLowerCase().split(" ");
      b = b.toLowerCase().split(" ");

      let matches = 0;
      for (let w of a) {
        if (b.some(x => levenshtein(w, x) <= 2)) {
          matches++;
        }
      }
      return matches;
    }

    function levenshtein(a, b) {
      const dp = Array.from({ length: a.length + 1 }, () =>
        Array(b.length + 1).fill(0)
      );

      for (let i = 0; i <= a.length; i++) dp[i][0] = i;
      for (let j = 0; j <= b.length; j++) dp[0][j] = j;

      for (let i = 1; i <= a.length; i++) {
        for (let j = 1; j <= b.length; j++) {
          dp[i][j] = Math.min(
            dp[i - 1][j] + 1,
            dp[i][j - 1] + 1,
            dp[i - 1][j - 1] + (a[i - 1] === b[j - 1] ? 0 : 1)
          );
        }
      }
      return dp[a.length][b.length];
    }

    function loadQuestion() {
      if (current >= quiz.length) {
        alert("Quiz finished! Final score: " + score);
        return;
      }

      document.getElementById("questionBox").classList.add("hidden");
      document.getElementById("answerInput").value = "";

      player.loadVideoById(quiz[current].videoId);
      player.playVideo();

      timer = setTimeout(() => {
        player.pauseVideo();
        document.getElementById("questionBox").classList.remove("hidden");
        document.getElementById("answerInput").focus();
      }, PLAY_TIME * 1000);
    }

    function submitAnswer() {
      const user = document.getElementById("answerInput").value.trim();
      const correct = quiz[current].answer;

      if (correct.length > 0 && user.length > 0) {
        const matchedWords = similarity(user, correct);
        score += exponentialScore(matchedWords);
      }

      document.getElementById("score").innerText = "Score: " + score;
      current++;
      loadQuestion();
    }

    document.getElementById("startBtn").onclick = () => {
      quiz = shuffle(QUESTION_POOL).slice(0, TOTAL_QUESTIONS);
      current = 0;
      score = 0;
      document.getElementById("score").innerText = "Score: 0";
      loadQuestion();
    };

    document.getElementById("submitBtn").onclick = submitAnswer;

    document.getElementById("answerInput").addEventListener("keydown", e => {
      if (e.key === "Enter") submitAnswer();
    });

    function onYouTubeIframeAPIReady() {
      player = new YT.Player("player", {
        height: "360",
        width: "100%",
        playerVars: {
          controls: 0,
          disablekb: 1,
          modestbranding: 1,
          rel: 0,
          fs: 0
        }
      });
    }
  </script>
</body>
</html>
