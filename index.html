<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>YouTube Lyrics Quiz</title>

  <style>
    body {
      background: #0f0f0f;
      color: #fff;
      font-family: system-ui, sans-serif;
      display: flex;
      justify-content: center;
      padding: 40px;
    }

    .app {
      width: 800px;
      background: #1a1a1a;
      padding: 20px;
      border-radius: 12px;
    }

    button {
      padding: 10px 18px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
    }

    #startBtn {
      background: #4caf50;
      color: #000;
      margin-bottom: 15px;
    }

    input {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      border-radius: 6px;
      border: none;
      margin-top: 10px;
    }

    .hidden {
      display: none;
    }

    #videoWrapper {
      margin-bottom: 15px;
      border-radius: 10px;
      overflow: hidden;
    }

    #score {
      margin-top: 10px;
      font-weight: bold;
    }
  </style>
</head>

<body>
  <div class="app">
    <button id="startBtn">Start Quiz</button>

    <div id="videoWrapper">
      <div id="player"></div>
    </div>

    <div id="questionBox" class="hidden">
      <p>Whatâ€™s the next line?</p>
      <input id="answerInput" placeholder="Type here..." />
      <button id="submitBtn">Submit</button>
    </div>

    <div id="score">Score: 0</div>
  </div>

  <script src="https://www.youtube.com/iframe_api"></script>

  <script>
    const QUESTION_POOL = [
      {
        videoId: "m7b7havwYSw",
        start: 0,
        answer: "deÄŸiÅŸecek zannediyor Yani hemen 1 Ocak 2000'de tak bir yerden bir yere Ä±ÅŸÄ±nlan acaÄŸÄ± zannediyor HayÄ±r Ã¶yle bir ÅŸey yok yani elinizdeki abonmanÄ± mavi kartlarÄ± atmayÄ±n Onlar lazÄ±m olacak" // ENTER ANSWER
      },
      {
        videoId: "xCKnlQT37WE",
        start: 0,
        answer: "kliÅŸe eylenme ve kutlama ÅŸeklinde en Ã§ok yakÄ±ÅŸan kÄ±rmÄ±zÄ± don giyme olayÄ±. GerÃ§ekten Noel Baba'nÄ±n hani getirdiÄŸi Ã§antada var mÄ± bakalÄ±m? KÄ±rmÄ±zÄ± don. Bu biraz bÃ¼yÃ¼k umutlar iÃ§in. BÃ¶yle salak sÃ¼sler var. BunlarÄ± koyunca bambaÅŸka bir insan oluyorsun herhalde. Ã–yle dÃ¼ÅŸÃ¼nÃ¼lmÃ¼ÅŸ." // ENTER ANSWER
      }
    ];

    const TOTAL_QUESTIONS = 10;
    const PLAY_TIME = 10;
    const RESUME_TIME = 4; // seconds after answering

    let player;
    let quiz = [];
    let current = 0;
    let score = 0;
    let timer;
    let resumeTimer;

    function shuffle(arr) {
      return [...arr].sort(() => Math.random() - 0.5);
    }

    function normalizeText(text) {
      return text
        .toLowerCase()
        .replace(/[.,!?;:"'()]/g, "")
        .replace(/Ä±/g, "i")
        .replace(/ÅŸ/g, "s")
        .replace(/Ã§/g, "c")
        .replace(/Ã¶/g, "o")
        .replace(/ÄŸ/g, "g")
        .replace(/Ã¼/g, "u")
        .trim();
    }

    function countCorrectWords(userAnswer, correctAnswer) {
      const userWords = new Set(normalizeText(userAnswer).split(/\s+/));
      const correctWords = new Set(normalizeText(correctAnswer).split(/\s+/));

      let count = 0;
      for (const word of correctWords) {
        if (userWords.has(word)) count++;
      }
      return count;
    }

    function exponentialScore(wordCount) {
      return Math.floor(Math.pow(1.35, wordCount) + wordCount * 2);
    }

    function loadQuestion() {
  clearTimeout(timer);
  clearTimeout(resumeTimer);

  if (current >= quiz.length) {
    alert("Quiz finished! Final score: " + score);
    return;
  }

  // ðŸ”“ Re-enable input for next question
  const input = document.getElementById("answerInput");
  input.disabled = false;
  input.value = "";

  document.getElementById("questionBox").classList.add("hidden");

      document.getElementById("questionBox").classList.add("hidden");
      document.getElementById("answerInput").value = "";

      player.loadVideoById({
        videoId: quiz[current].videoId,
        startSeconds: quiz[current].start
      });

      player.playVideo();

      timer = setTimeout(() => {
        player.pauseVideo();
        document.getElementById("questionBox").classList.remove("hidden");
        document.getElementById("answerInput").focus();
      }, PLAY_TIME * 1000);
    }

function submitAnswer() {
  clearTimeout(timer);
  clearTimeout(resumeTimer);

  const input = document.getElementById("answerInput");
  const user = input.value;
  const correct = quiz[current].answer;

  if (correct && user) {
    const correctWords = countCorrectWords(user, correct);
    score += exponentialScore(correctWords);
  }

  document.getElementById("score").innerText = "Score: " + score;
  document.getElementById("questionBox").classList.add("hidden");

  // ðŸ”’ Disable input DURING resume playback
  input.disabled = true;

  // â–¶ Resume video for 4 seconds
  player.playVideo();

  resumeTimer = setTimeout(() => {
    player.pauseVideo();
    current++;
    loadQuestion();
  }, RESUME_TIME * 1000);
}



    document.getElementById("submitBtn").onclick = submitAnswer;

    document.getElementById("answerInput").addEventListener("keydown", e => {
      if (e.key === "Enter") submitAnswer();
    });

    function onYouTubeIframeAPIReady() {
      player = new YT.Player("player", {
        height: "360",
        width: "100%",
        playerVars: {
          controls: 0,
          disablekb: 1,
          modestbranding: 1,
          rel: 0,
          fs: 0
        }
      });
    }
  </script>
</body>
</html>
