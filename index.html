<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>YouTube Lyrics Quiz</title>

  <style>
    body {
      background: #0f0f0f;
      color: #fff;
      font-family: system-ui, sans-serif;
      display: flex;
      justify-content: center;
      padding: 40px;
    }

    .app {
      width: 800px;
      background: #1a1a1a;
      padding: 20px;
      border-radius: 12px;
    }

    button {
      padding: 10px 18px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
    }

    #startBtn {
      background: #4caf50;
      color: #000;
      margin-bottom: 15px;
    }

    input {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      border-radius: 6px;
      border: none;
      margin-top: 10px;
    }

    .hidden {
      display: none;
    }

    #videoWrapper {
      margin-bottom: 15px;
      border-radius: 10px;
      overflow: hidden;
    }

    #score {
      margin-top: 10px;
      font-weight: bold;
    }
  </style>
</head>

<body>
  <div class="app">
    <button id="startBtn">Start Quiz</button>

    <div id="videoWrapper">
      <div id="player"></div>
    </div>

    <div id="questionBox" class="hidden">
      <p>What’s the next line?</p>
      <input id="answerInput" placeholder="Type here..." />
      <button id="submitBtn">Submit</button>
    </div>

    <div id="score">Score: 0</div>
  </div>

  <script src="https://www.youtube.com/iframe_api"></script>

  <script>
    const QUESTION_POOL = [
      {
        videoId: "m7b7havwYSw",
        start: 0,
        answer: "değişecek zannediyor Yani hemen 1 Ocak 2000'de tak bir yerden bir yere ışınlan acağı zannediyor Hayır öyle bir şey yok yani elinizdeki abonmanı mavi kartları atmayın Onlar lazım olacak" // ENTER ANSWER
      },
      {
        videoId: "xCKnlQT37WE",
        start: 0,
        answer: "klişe eylenme ve kutlama şeklinde en çok yakışan kırmızı don giyme olayı. Gerçekten Noel Baba'nın hani getirdiği çantada var mı bakalım? Kırmızı don. Bu biraz büyük umutlar için. Böyle salak süsler var. Bunları koyunca bambaşka bir insan oluyorsun herhalde. Öyle düşünülmüş." // ENTER ANSWER
      }
    ];

    const TOTAL_QUESTIONS = 10;
    const PLAY_TIME = 10;

    let player;
    let quiz = [];
    let current = 0;
    let score = 0;
    let timer;

    function shuffle(arr) {
      return [...arr].sort(() => Math.random() - 0.5);
    }

    function normalizeText(text) {
      return text
        .toLowerCase()
        .replace(/[.,!?;:"'()]/g, "")
        .replace(/ı/g, "i")
        .replace(/ş/g, "s")
        .replace(/ç/g, "c")
        .replace(/ö/g, "o")
        .replace(/ğ/g, "g")
        .replace(/ü/g, "u")
        .trim();
    }

    function countCorrectWords(userAnswer, correctAnswer) {
      const userWords = new Set(normalizeText(userAnswer).split(/\s+/));
      const correctWords = new Set(normalizeText(correctAnswer).split(/\s+/));

      let count = 0;
      for (const word of correctWords) {
        if (userWords.has(word)) count++;
      }
      return count;
    }

    function exponentialScore(wordCount) {
      return Math.floor(Math.pow(1.35, wordCount) + wordCount * 2);
    }

    function loadQuestion() {
      clearTimeout(timer);

      if (current >= quiz.length) {
        alert("Quiz finished! Final score: " + score);
        return;
      }

      document.getElementById("questionBox").classList.add("hidden");
      document.getElementById("answerInput").value = "";

      player.loadVideoById({
        videoId: quiz[current].videoId,
        startSeconds: quiz[current].start
      });

      player.playVideo();

      timer = setTimeout(() => {
        player.pauseVideo();
        document.getElementById("questionBox").classList.remove("hidden");
        document.getElementById("answerInput").focus();
      }, PLAY_TIME * 1000);
    }

    function submitAnswer() {
      const user = document.getElementById("answerInput").value;
      const correct = quiz[current].answer;

      if (correct && user) {
        const correctWords = countCorrectWords(user, correct);
        score += exponentialScore(correctWords);
      }

      document.getElementById("score").innerText = "Score: " + score;
      current++;
      loadQuestion();
    }

    document.getElementById("startBtn").onclick = () => {
      quiz = shuffle(QUESTION_POOL).slice(0, TOTAL_QUESTIONS);
      current = 0;
      score = 0;
      document.getElementById("score").innerText = "Score: 0";
      loadQuestion();
    };

    document.getElementById("submitBtn").onclick = submitAnswer;

    document.getElementById("answerInput").addEventListener("keydown", e => {
      if (e.key === "Enter") submitAnswer();
    });

    function onYouTubeIframeAPIReady() {
      player = new YT.Player("player", {
        height: "360",
        width: "100%",
        playerVars: {
          controls: 0,
          disablekb: 1,
          modestbranding: 1,
          rel: 0,
          fs: 0
        }
      });
    }
  </script>
</body>
</html>
